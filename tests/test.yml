---
- hosts: test_machine
  become: yes

- hosts: test_machine
  become: yes

  vars:
    docker_volumes: /srv/docker
    docker_network_interface: 172.17.0.1

  roles:
    - role: install-docker
      storage_driver: overlay2
      cleanup_enabled: true
      install_pip_docker: yes

    - role: ansible-nginx
      volume: /srv/docker/nginx
      clear_dh_parameter: no
      dh_parameter_bits: 1024
      ticketkey_enabled: yes
      configs:
        gitlab:
          https: false
          upstreams:
            gitlab: "172.17.0.1:10080"
          server_name: git.myserver.org
          locations:
            - location: /
              proxy_to: http://gitlab/
        harbor_ui:
          https: false
          upstreams:
            harbor_ui: "172.17.0.1:50080"
            harbor_registry: "172.17.0.1:55000"
          server_name: my.harbor.org
          locations:
            - location: /
              proxy_to: http://harbor_ui/
            - location: /v1/
              returns: 404
            - location: /v2/
              proxy_to: http://harbor_registry/v2/
            - location: /service/
              proxy_to: http://harbor_ui/service/
            - location: /service/notifications
              returns: 404
